<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Template 5</title>
    <link rel="stylesheet" href="http://te4projekt.se/css/main.css" />
    <script src="http://te4projekt.se/scripts/clockAndDate.js"></script>
    <style type="text/css">
      .page {
        position: absolute;
        width: 100%;
      }
    </style>
    <script type="text/javascript">
      const fade = [
        { opacity: "100%", zIndex: "1" },
        { opacity: "0%", zIndex: "1" },
      ];
      const appear = [{ opacity: "100%", zIndex: "0" }];
      const disappear = [{ opacity: "0%", zIndex: "-1" }];

      let array = null;
      let str;
      let changed = false;
      let counter = 0;
      let i = 0;
      const source = new EventSource("events");

      source.addEventListener("message", (message) => {
        if (str != message.data) {
          console.log("got new stuff!");
          changed = true;
          str = message.data;
          document.body.innerHTML = str;
          array = document.getElementsByClassName("page");
        }
      });

      setInterval(() => {
        counter += 1000;
        if (changed) {
          console.log("stuff changed! changed!");
          changed = false;
          console.log(array[i])
          array[i].style.opacity = "100%";
          for (let index = 0; index < array.length; index++) {
            if (index != i) {
              array[index].style.opacity = "0%";
            }
          }
        }
        if (array.length > 1) {
          if (counter % 10000 == 0) {
            for (let index = 0; index < array.length; index++) {
              if (index !== i || index !== (i + 1) % array.length) {
                array[index].animate(disappear, {
                  duration: 0,
                  iterations: 1,
                  fill: "forwards",
                });
              }
            }
            console.log(`Changing from ${i} to ${(i + 1) % array.length}`);

            array[(i + 1) % array.length].animate(appear, {
              duration: 0,
              iterations: 1,
              fill: "forwards",
            });

            array[i].animate(fade, {
              duration: 0,
              iterations: 1,
              fill: "forwards",
            });
            i = (i + 1) % array.length;
          }
        }
      }, 1000);
    </script>
  </head>
  <body></body>
</html>
